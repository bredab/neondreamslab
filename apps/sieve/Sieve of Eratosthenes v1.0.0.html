<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sieve of Eratosthenes v1.0.0</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1a1a2e;
            color: #fff;
            display: flex;
            flex-direction: row;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        .sidebar {
            width: 320px;
            background: #16213e;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.5);
            z-index: 10;
            overflow-y: auto;
            flex-shrink: 0;
        }

        .main-content {
            flex: 1;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #1a1a2e;
            overflow: hidden;
            position: relative;
        }

        h1 { 
            margin: 0; 
            font-size: 24px;
            color: #fff;
        }
        
        .description {
            color: #a0a0c0;
            font-size: 14px;
            line-height: 1.5;
        }

        .controls {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        button {
            padding: 12px;
            font-size: 16px;
            cursor: pointer;
            background-color: #0f3460;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background 0.3s;
            width: 100%;
        }

        button:hover { background-color: #e94560; }
        button:disabled { background-color: #555; cursor: not-allowed; }

        .legend {
            display: flex;
            flex-direction: column;
            gap: 10px;
            font-size: 14px;
        }
        .legend-item { display: flex; align-items: center; gap: 10px; }
        .dot { width: 15px; height: 15px; border-radius: 3px; }

        #status {
            font-size: 16px;
            font-weight: bold;
            color: #f1c40f;
            min-height: 40px;
        }

        #grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-auto-rows: 1fr;
            gap: 5px;
            width: 100%;
            height: 100%;
        }

        .cell {
            background-color: #eee; /* This is bit 1 */
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 5px;
            font-weight: bold;
            /* Dynamic font size based on viewport width */
            font-size: clamp(12px, 2vw, 24px); 
            transition: transform 0.2s, background-color 0.3s;
            position: relative;
        }

        /* States */
        .cell.prime {
            background-color: #2ecc71; /* Green - Found prime */
            color: white;
            border: 2px solid #27ae60;
            transform: scale(1.05);
            z-index: 10;
        }

        .cell.composite {
            background-color: #e74c3c; /* Red - Zeroed bit */
            color: white;
            opacity: 0.6;
        }

        /* Wave animation */
        .cell.scanning {
            background-color: #f1c40f; /* Yellow - Currently scanning */
            transform: scale(1.1);
            z-index: 20;
            box-shadow: 0 0 10px #f1c40f;
        }

        .cell.hidden {
            visibility: hidden; /* Optionally hide 0 and 1 */
        }
        
    </style>
</head>
<body>

    <div class="sidebar">
        <h1>Sieve of Eratosthenes v1.0.0</h1>
        
        <div class="description">
            This visualization demonstrates the Sieve of Eratosthenes. <br>
            Green numbers are found primes. <br>
            The algorithm proceeds by filtering out multiples (marking them red) for each new prime discovered.
        </div>

        <div class="controls">
            <button id="btnNext" onclick="nextWave()">Start Search</button>
            <button id="btnReset" onclick="resetGrid()">Restart</button>
        </div>

        <div class="legend">
            <div class="legend-item"><div class="dot" style="background:#eee"></div> Unknown</div>
            <div class="legend-item"><div class="dot" style="background:#2ecc71"></div> Prime Number</div>
            <div class="legend-item"><div class="dot" style="background:#e74c3c"></div> Composite Number</div>
        </div>

        <div id="status">Start the search!</div>
    </div>

    <div class="main-content">
        <div id="grid"></div>
    </div>

    <script>
        const MAX_NUMBER = 100; // Search up to here
        const grid = document.getElementById('grid');
        const statusDiv = document.getElementById('status');
        let numbers = []; // This is our bit array (true = 1, false = 0)
        let currentPrime = 2; // Start from here
        let isAnimating = false;

        // Grid initialization
        function initGrid() {
            grid.innerHTML = '';
            numbers = new Array(MAX_NUMBER + 1).fill(true); // Everyone is 1 (potential prime)
            numbers[0] = false;
            numbers[1] = false;

            for (let i = 1; i <= MAX_NUMBER; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');
                cell.id = 'cell-' + i;
                cell.textContent = i;
                if (i === 1) cell.style.opacity = '0.3'; // 1 is gray
                grid.appendChild(cell);
            }
        }

        function resetGrid() {
            if(isAnimating) return;
            currentPrime = 2;
            initGrid();
            statusDiv.textContent = "Grid reset.";
            document.getElementById('btnNext').disabled = false;
            document.getElementById('btnNext').textContent = "Start Search";
        }

        function highlightCell(id, type) {
            const cell = document.getElementById('cell-' + id);
            if (type === 'prime') {
                cell.className = 'cell prime';
            } else if (type === 'composite') {
                // If it was already composite, stay so, but flash once
                if(!cell.classList.contains('composite')) {
                    cell.className = 'cell composite';
                }
            } else if (type === 'scan') {
                cell.classList.add('scanning');
            } else if (type === 'unscan') {
                cell.classList.remove('scanning');
            }
        }

        async function nextWave() {
            if (isAnimating) return;
            isAnimating = true;
            document.getElementById('btnNext').disabled = true;

            // 1. Find the next 1 bit (Prime)
            let foundNext = false;
            
            // If we passed the square root, the rest are all primes
            if (currentPrime * currentPrime > MAX_NUMBER) {
                // Just color the rest quickly
                for(let i = currentPrime; i <= MAX_NUMBER; i++) {
                    if(numbers[i]) highlightCell(i, 'prime');
                }
                statusDiv.textContent = "Done! All primes found.";
                isAnimating = false;
                return;
            }

            // Find the next active bit
            while (currentPrime <= MAX_NUMBER && !numbers[currentPrime]) {
                currentPrime++;
            }

            if (currentPrime > MAX_NUMBER) {
                statusDiv.textContent = "Done!";
                return;
            }

            // This is a prime!
            highlightCell(currentPrime, 'prime');
            statusDiv.textContent = `Sieving multiples of ${currentPrime}... (Zeroing every ${currentPrime}. bit)`;

            // Wait a bit so the user sees the prime
            await new Promise(r => setTimeout(r, 500));

            // 2. Start the WAVE (animation)
            // According to your idea: wavelength = currentPrime
            // Optimization: we could start from currentPrime^2, but due to the wave effect
            // we start from currentPrime * 2 to show the jumping.
            
            for (let i = currentPrime * 2; i <= MAX_NUMBER; i += currentPrime) {
                // Move wave front
                highlightCell(i, 'scan');
                await new Promise(r => setTimeout(r, 100)); // Animation speed
                highlightCell(i, 'unscan');

                // Flip bit to 0 (Red)
                numbers[i] = false;
                highlightCell(i, 'composite');
            }

            currentPrime++;
            isAnimating = false;
            document.getElementById('btnNext').disabled = false;
            document.getElementById('btnNext').textContent = "Filter Multiples";
        }

        // On startup
        initGrid();

    </script>
</body>
</html>