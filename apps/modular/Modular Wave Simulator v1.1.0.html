<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Modular Wave Simulator v1.1.0</title>
    <style>
        :root {
            --bg-color: #050505;
            --panel-bg: #111;
            --text-color: #ccc;
            --accent-cyan: #00f3ff;
            --accent-pink: #ff00ff;
            --dot-inactive: #006064;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: row; /* Sidebar layout */
            align-items: stretch;
            margin: 0;
            padding: 0;
            height: 100vh;
            overflow: hidden;
            box-sizing: border-box;
        }

        /* Sidebar Styling */
        .sidebar {
            width: 320px;
            background: #0f0f15;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            border-right: 1px solid #333;
            z-index: 10;
            overflow-y: auto;
            flex-shrink: 0;
            box-shadow: 2px 0 10px rgba(0,0,0,0.5);
        }

        h1 { margin: 0 0 5px 0; font-weight: 300; letter-spacing: 2px; color: #fff; font-size: 20px; }
        .subtitle { font-size: 13px; color: #888; margin-bottom: 10px; line-height: 1.4; text-align: left; }

        .controls {
            background: var(--panel-bg);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #333;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 15px;
            box-sizing: border-box;
        }

        .control-row {
            display: flex;
            flex-direction: column; /* Stack label and input on sidebar */
            align-items: flex-start;
            gap: 5px;
            width: 100%;
        }

        .label-group { display: flex; justify-content: space-between; width: 100%; align-items: center; }
        .label-title { font-size: 12px; color: #666; font-weight: bold; text-transform: uppercase; }
        .label-value { font-family: monospace; font-size: 18px; color: var(--accent-cyan); font-weight: bold; }

        input[type=range] {
            width: 100%;
            cursor: pointer;
            accent-color: var(--accent-cyan);
            height: 6px;
            background: #333;
            border-radius: 3px;
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            background-color: var(--bg-color);
            overflow: hidden;
            position: relative;
            align-items: center;
            justify-content: center;
        }

        /* INF√ì DOBOZ - Fixed at bottom */
        .info-box {
            min-height: 50px;
            width: 100%;
            background: #0f0f15;
            border-left: 4px solid var(--accent-pink);
            border-top: 1px solid #333;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding: 10px 15px;
            box-sizing: border-box;
            /* Static position in flex flow */
            flex-shrink: 0; 
        }
        
        .info-text {
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            color: #fff;
            width: 100%;
            text-align: left;
            line-height: 1.4;
            white-space: normal;
        }
        .highlight { color: var(--accent-pink); font-weight: bold; }
        .highlight-cyan { color: var(--accent-cyan); font-weight: bold; }
        .separator { color: #555; margin: 0 8px; font-weight: normal; }

        /* VIZUALIZ√ÅCI√ì */
        .vis-container {
            position: relative;
            width: 100%;
            flex: 1; /* Take remaining space */
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 0; /* Enable shrinking */
        }

        canvas {
            background: var(--panel-bg);
            border-radius: 8px 8px 0 0;
            border: 1px solid #333;
            border-bottom: none;
            cursor: crosshair;
            width: 100%;
            height: 100%; /* Fill container */
            object-fit: contain; /* Or fill depending on resize logic */
            display: block;
        }

        .pixel-row-wrapper {
            background: #000;
            border: 1px solid #333;
            border-top: 1px solid #444;
            border-radius: 0 0 8px 8px;
            padding-left: 40px; 
            padding-right: 20px; 
            box-sizing: border-box;
            width: 100%;
            flex-shrink: 0; /* Don't shrink */
        }

        .pixel-row {
            display: flex;
            height: 40px;
            width: 100%;
        }

        .pixel {
            flex: 1;
            border-right: 1px solid #222;
            background: #000;
            transition: background 0.1s;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #333;
        }
        .pixel:last-child { border-right: none; }
        
        .pixel.active {
            background: var(--accent-pink);
            box-shadow: 0 0 15px var(--accent-pink);
            color: white;
            font-weight: bold;
            z-index: 1;
        }

        #hoverMarker {
            position: absolute;
            top: 0; 
            bottom: 40px; /* Adjust based on pixel row height */
            width: 1px;
            background: rgba(255, 255, 255, 0.5);
            pointer-events: none;
            display: none;
            border-left: 1px dashed rgba(255,255,255,0.2);
            z-index: 5;
        }

        /* Mobile & Responsive Additions */
        #rotate-warning { 
            display: none; 
        }

        #fullscreen-btn {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.5);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            z-index: 1000;
            font-size: 12px;
            text-transform: uppercase;
            width: auto;
        }
        
        #fullscreen-btn:hover {
            background: var(--accent-cyan);
            color: #000;
            border-color: var(--accent-cyan);
        }

        @media screen and (orientation: portrait) {
            .sidebar, .main-content, #fullscreen-btn { 
                display: none !important; 
            }
            #rotate-warning {
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                position: fixed;
                top: 0; 
                left: 0;
                width: 100%; 
                height: 100%;
                background: #050505;
                color: #fff;
                font-family: Arial, sans-serif;
                text-align: center;
                z-index: 9999;
                padding: 20px;
                box-sizing: border-box;
            }
        }

        @media screen and (max-width: 900px) and (orientation: landscape) {
            .sidebar {
                width: 240px;
                padding: 10px;
                gap: 10px;
            }
            h1 { font-size: 16px; }
            .subtitle { font-size: 11px; }
            .controls { padding: 10px; gap: 10px; }
            .label-value { font-size: 16px; }
            .main-content { padding: 10px; }
        }

    </style>
</head>
<body>

    <div id="rotate-warning">
        <div style="font-size: 50px; margin-bottom: 20px;">üîÑ</div>
        <h2>Please Rotate Your Device</h2>
        <p>This experiment requires landscape mode.</p>
    </div>

    <button id="fullscreen-btn" onclick="toggleFullScreen()">‚õ∂ Fullscreen</button>

    <div class="sidebar">
        <h1>Modular Wave Simulator v1.1.0</h1>
        <div class="subtitle">
            Set the number (N) and the wave frequency (k)!<br>
            Observe how the pattern changes with prime numbers (e.g., 13) and composite numbers (e.g., 36).
        </div>

        <div class="controls">
            <!-- N Cs√∫szka -->
            <div class="control-row">
                <div class="label-group">
                    <span class="label-title">Number (N)</span>
                    <span id="valN" class="label-value">36</span>
                </div>
                <input type="range" id="inputN" min="3" max="36" step="1" value="36">
            </div>

            <!-- K Cs√∫szka -->
            <div class="control-row">
                <div class="label-group">
                    <span class="label-title">Frequency (k)</span>
                    <span id="valK" class="label-value">1</span>
                </div>
                <input type="range" id="inputK" min="1" max="35" step="1" value="1">
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="vis-container" id="visContainer">
            <canvas id="waveCanvas"></canvas>
            
            <div class="pixel-row-wrapper">
                <div id="pixelRow" class="pixel-row"></div>
            </div>
            
            <div id="hoverMarker"></div>
        </div>
        
    <div id="infoBox" class="info-box">
        <div class="info-text">
            <div style="margin-bottom: 4px;">Position (x): - <span class="separator">|</span> Multiplication: -</div>
            <div>Modulo: -</div>
        </div>
    </div>
    </div>

<script>
    // Glob√°lis v√°ltoz√≥k
    let currentN = 36;
    let currentK = 1;

    // DOM elemek
    const canvas = document.getElementById('waveCanvas');
    const ctx = canvas.getContext('2d');
    const pixelRow = document.getElementById('pixelRow');
    
    const inputN = document.getElementById('inputN');
    const inputK = document.getElementById('inputK');
    const valN = document.getElementById('valN');
    const valK = document.getElementById('valK');
    
    const infoBox = document.getElementById('infoBox');
    const marker = document.getElementById('hoverMarker');
    const container = document.getElementById('visContainer');

    // Marg√≥k a sk√°l√°khoz
    const PADDING_LEFT = 40;
    const PADDING_RIGHT = 20;
    const PADDING_TOP = 30;
    const PADDING_BOTTOM = 30;

    let canvasWidth, canvasHeight;
    let graphWidth, graphHeight;
    let cellWidth; 

    // --- 1. Inicializ√°l√°s: Pixelek l√©trehoz√°sa ---
    function initPixels() {
        pixelRow.innerHTML = ''; // T√∂rl√©s
        for (let i = 0; i < currentN; i++) {
            const div = document.createElement('div');
            div.className = 'pixel';
            pixelRow.appendChild(div);
        }
    }

    // --- 2. M√©retez√©s ---
    function resize() {
        const rect = container.getBoundingClientRect();
        canvasWidth = rect.width;
        // Calculate available height: container height - pixel row height (42px approx)
        // pixel-row-wrapper height is around 40px + padding/borders. Let's say 42px.
        // But we want the canvas to fill the remaining space.
        // The container is flex column. Canvas should flex-grow.
        // However, setting canvas.height affects internal resolution.
        // We can use the container height minus the bottom part.
        
        const wrapperHeight = 42; 
        const availableHeight = rect.height - wrapperHeight;
        
        canvasHeight = Math.max(200, availableHeight); 
        
        graphWidth = canvasWidth - PADDING_LEFT - PADDING_RIGHT;
        graphHeight = canvasHeight - PADDING_TOP - PADDING_BOTTOM;
        
        canvas.width = canvasWidth;
        canvas.height = canvasHeight;
        
        cellWidth = graphWidth / currentN; // Fontos: az √∫j N-el sz√°molunk
        draw();
    }

    function toggleFullScreen() {
        if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen().catch(err => {
                console.log(`Error attempting to enable fullscreen: ${err.message}`);
            });
        } else {
            if (document.exitFullscreen) document.exitFullscreen();
        }
    }

    // --- 3. Rajzol√°s ---
    function draw() {
        ctx.clearRect(0, 0, canvasWidth, canvasHeight);

        ctx.font = '10px monospace';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';

        // X Tengely (F√ºgg≈ëleges vonalak)
        // Optimaliz√°ci√≥: Ha N nagy, ne √≠rjunk ki minden sz√°mot
        const stepX = currentN > 20 ? 2 : 1; 

        for (let x = 0; x < currentN; x++) {
            const xPos = PADDING_LEFT + x * cellWidth + (cellWidth/2);
            
            // R√°cs
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(xPos, PADDING_TOP);
            ctx.lineTo(xPos, canvasHeight - PADDING_BOTTOM);
            ctx.stroke();

            // Sz√°mok
            ctx.fillStyle = '#666';
            if (x % stepX === 0) { 
                ctx.fillText(x, xPos, PADDING_TOP - 15); 
                ctx.fillText(x, xPos, canvasHeight - PADDING_BOTTOM + 15); 
            }
        }

        // Y Tengely (V√≠zszintes vonalak - Marad√©kok)
        // 0-t√≥l N-1-ig
        const yStepCount = Math.min(currentN, 6); // Max 6 oszt√°st rajzoljunk, ne legyen zs√∫folt
        const yValueStep = Math.ceil((currentN - 1) / yStepCount);
        
        ctx.textAlign = 'right';
        
        // Seg√©df√ºggv√©ny Y poz√≠ci√≥hoz
        const getYPos = (val) => (canvasHeight - PADDING_BOTTOM) - (val / (currentN - 1)) * graphHeight;

        for (let val = 0; val < currentN; val += yValueStep) {
            const yPos = getYPos(val);

            ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
            ctx.beginPath();
            ctx.moveTo(PADDING_LEFT, yPos);
            ctx.lineTo(canvasWidth - PADDING_RIGHT, yPos);
            ctx.stroke();

            ctx.fillStyle = '#00f3ff';
            ctx.fillText(val, PADDING_LEFT - 10, yPos);
        }
        // Fels≈ë hat√°r (N-1) mindig legyen kirajzolva
        const topY = getYPos(currentN - 1);
        ctx.fillText(currentN - 1, PADDING_LEFT - 10, topY);

        // Tengely c√≠mke
        ctx.save();
        ctx.fillStyle = '#888';
        ctx.textAlign = 'center';
        ctx.translate(15, canvasHeight/2);
        ctx.rotate(-Math.PI/2);
        ctx.fillText("REMAINDER", 0, 0);
        ctx.restore();


        // A HULL√ÅM
        ctx.beginPath();
        ctx.strokeStyle = '#00f3ff';
        ctx.lineWidth = 2;
        ctx.shadowBlur = 10;
        ctx.shadowColor = 'rgba(0, 243, 255, 0.5)';

        const pixels = document.querySelectorAll('.pixel');

        // Fontos: a pixelek list√°j√°nak hossza most m√°r v√°ltozik, de az initPixels() kezeli
        // Itt csak biztons√°gi ellen≈ërz√©s
        if (pixels.length !== currentN) return; 

        for (let x = 0; x < currentN; x++) {
            const rawValue = currentK * x;
            const modValue = rawValue % currentN;

            const plotX = PADDING_LEFT + x * cellWidth + (cellWidth / 2);
            const plotY = getYPos(modValue);

            if (x === 0) ctx.moveTo(plotX, plotY);
            else ctx.lineTo(plotX, plotY);
        }
        ctx.stroke();
        ctx.shadowBlur = 0;

        // P√ñTTY√ñK
        for (let x = 0; x < currentN; x++) {
            const rawValue = currentK * x;
            const modValue = rawValue % currentN;

            const plotX = PADDING_LEFT + x * cellWidth + (cellWidth / 2);
            const plotY = getYPos(modValue);

            ctx.beginPath();
            
            if (modValue === 0) {
                // Tal√°lat
                ctx.fillStyle = '#ff00ff';
                ctx.shadowBlur = 15;
                ctx.shadowColor = '#ff00ff';
                ctx.arc(plotX, plotY, 5, 0, Math.PI * 2);
                pixels[x].classList.add('active');
            } else {
                // Inakt√≠v
                ctx.fillStyle = '#006064';
                ctx.shadowBlur = 0;
                ctx.arc(plotX, plotY, 3, 0, Math.PI * 2);
                pixels[x].classList.remove('active');
            }
            ctx.fill();
        }
    }

    // --- 4. Interakci√≥ ---
    function handleInteraction(clientX) {
        const rect = container.getBoundingClientRect();
        const mouseX = clientX - rect.left;
        
        let relativeX = mouseX - PADDING_LEFT;
        if (relativeX < 0) relativeX = 0;
        if (relativeX > graphWidth) relativeX = graphWidth - 1;

        let index = Math.floor(relativeX / cellWidth);
        if (index < 0) index = 0;
        if (index >= currentN) index = currentN - 1;

        updateMarkerAndInfo(index);
    }

    function updateMarkerAndInfo(index) {
        const markerPos = PADDING_LEFT + index * cellWidth + cellWidth/2;
        marker.style.left = markerPos + 'px';
        marker.style.display = 'block';

        const raw = currentK * index;
        const mod = raw % currentN;
        const cycles = Math.floor(raw / currentN);

        let hitHtml = '';
        if (mod === 0) {
            hitHtml = ` <span class="highlight">‚ûî HIT!</span>`;
        }

        let html = `<div class="info-text">`;
        html += `<div style="margin-bottom: 4px;">Position (x): <span class="highlight-cyan">${index}</span>`;
        html += `<span class="separator">|</span>`;
        html += `Multiplication: ${currentK} √ó ${index} = <span class="highlight-cyan">${raw}</span></div>`;
        html += `<div>Modulo: ${raw} / ${currentN} = <b>${cycles}</b> integer, remainder: <span class="highlight">${mod}</span>${hitHtml}</div>`;
        html += `</div>`;

        infoBox.innerHTML = html;
    }

    function resetInfoBox() {
        infoBox.innerHTML = `
        <div class="info-text">
            <div style="margin-bottom: 4px;">Position (x): - <span class="separator">|</span> Multiplication: -</div>
            <div>Modulo: -</div>
        </div>`;
    }

    function updateKRange() {
        // A frekvencia maximuma mindig N-1
        const maxK = Math.max(1, currentN - 1);
        inputK.max = maxK;
        
        // Ha a jelenlegi K nagyobb, mint az √∫j maximum, h√∫zzuk vissza
        if (currentK > maxK) {
            currentK = maxK;
            inputK.value = currentK;
            valK.textContent = currentK;
        }
    }

    // Esem√©nyek
    inputN.addEventListener('input', (e) => {
        currentN = parseInt(e.target.value);
        valN.textContent = currentN;
        updateKRange();
        initPixels(); // √öjragener√°ljuk a DOM elemeket
        resize();     // √öjrarajzoljuk a v√°sznat
    });

    inputK.addEventListener('input', (e) => {
        currentK = parseInt(e.target.value);
        valK.textContent = currentK;
        draw();
    });

    // Mouse Events
    container.addEventListener('mousemove', (e) => handleInteraction(e.clientX));
    container.addEventListener('mouseleave', () => {
        marker.style.display = 'none';
        resetInfoBox();
    });

    // Touch Events
    container.addEventListener('touchstart', (e) => {
        e.preventDefault(); // Prevent scrolling
        handleInteraction(e.touches[0].clientX);
    }, { passive: false });

    container.addEventListener('touchmove', (e) => {
        e.preventDefault(); // Prevent scrolling
        handleInteraction(e.touches[0].clientX);
    }, { passive: false });
    
    window.addEventListener('resize', resize);

    // Start
    updateKRange();
    initPixels();
    setTimeout(resize, 10);

</script>
</body>
</html>